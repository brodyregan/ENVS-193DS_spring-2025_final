---
title: "ENVS-193DS Final"
format: html
---

Here is the link to my repository: https://github.com/brodyregan/ENVS-193DS_spring-2025_final

```{r message=FALSE, warning=FALSE} 
## Packages
library(tidyverse) # general use
library(here) # file organization
library(gt) # creating summary tables
library(flextable) # creating summary tables
library(janitor) # cleaning data frames
library(lubridate) 
library(DHARMa) # run diagnostics
library(MuMIn)  # model selection


## Data
sst <- read_csv(here("data", "SST_update2023.csv")) #load SBC data set
nest_boxes <- read_csv(here("data", "occdist.csv"))
```


# Problem 1: 

## a. 
[In part 1, they likely used a simple linear regression. This is because they were examining the relationship between two continuous variables. The variables are distance from head water in km and annual total nitrogen load in kg/yr. The p-value likely tested whether there was a statistically significant linear relationship between the two measured variables.

In part 2, they likely used a one-way Analysis of Variance test to compare average nitrogen load based on multiple sources (categorical). The ANOVA test compares the means of a continuous response variable (nitrogen load) across multiple categorical groups.]

## b. 
[Another test that would beneficial to this analysis would be the Post-hoc comparison. ANOVA tells us that there is at least one group mean that is statistically different from the others, but does not specify which one. A post-hoc comparison would test each group of nitrogen sources indicating which ones have differences clarifying where differences in nitrogen load occur. 

I would also recommend stating summary statistics for respective groups including the mean, standard error, and sample size. This would allow us to understand the magnitude and reliability of the data for each location while providing context for the situation.]

## c. 
[Part 1: The results from this simple linear regression showed that sites farther from the headwaters of the San Joaquin River tended to have higher total nitrogen loads (test statistic = ..., df = ..., p = 0.03, α = ..., sample size =...).

Part 2. The ANOVA comparisons show that average nitrogen loads differed among source types (F = ..., DF = ..., p = 0.02, α = ..., sample size = ..., SS = ...) indicating that source locations plays a role in nutrient pollution levels. The post-hoc test compares each group against each other showing (diff = ..., CI = ..., p = ...)]

# Problem 2:

## a.

```{r cleaning data frame}
sst_clean <- sst |> #create a new clean data frame 
  mutate( #mutate function
    date = ymd(date), #change date column to proper format
    year = year(date), #extract year from the date column
    month = month(date, label = TRUE, abbr = TRUE) #extract moonth from date column but abbreviate each name
  ) |> 
  filter(year >= 2018) |> #only keep years 2018 and more recent
  group_by(year, month) |> #group data by year and month 
  summarize(mean_monthly_sst = mean(temp, na.rm = TRUE), #calculate average SST for each group (year-month)
            .groups = "drop") |>  #ungroup the results are summarizing
  mutate( #mutate function
    year = factor(year), #convert year into a faccot
    month = factor(month, levels = month.abb, ordered = TRUE) #order month from Jan to Dec
  )
```

```{r}

str(sst_clean) #display the structure of the data frame

```

```{r}
slice_sample(sst_clean, n = 5) #display the first 5 rows of the table
```

## b. 

```{r Visualization}
ggplot(data = sst_clean |> #load clean data set
         mutate(year = factor(year, levels = sort(unique(year)))),  # make sure order is separated by year (to make discrete colors for the gradient)
       aes(x = month, #set x axis months
           y = mean_monthly_sst, #set y axis to mean monthly temperature
           group = year, #separate by year
           color = year)) + #make each year its own individual color
  geom_line() + #make the lines 
  geom_point() + #make points 
  scale_color_brewer(palette = "Blues", name = "Year") + #create color gradient for specific years
    labs(x = "Month", #label x axis months 
         y = "Mean monthly sea surface temperature (°C)", #label y axis mean monthly sea surface temperature
         color = "Year")+ #make the legend title Year
    theme_minimal()+ #change theme to minimal 
    theme(panel.grid = element_blank(), #remove grid
          panel.background = element_rect(fill = "white", color = "black"), #make background white and black border
          legend.position = c(0.1, 0.7), #position the legend in the top left corner
          legend.background = element_blank()) #remove the black border around the legend 
  

```



  
# Problem 3:

## a.
[The 0s and 1s in this data set represent species-specific or occupancy status for each next box. A value of 1 for 'sp, cs, or tm' means the box is occupied by that specie and if the value is 1 under the 'e' column, the box is empty. Biologically, this allows for analysis of the species occupying the box to gain assess habitat preference or competition.]

## b. 
[In this study, the Swift Parrots are the target species for conservation, with nesting boxes placed in a forest to promote their breeding and survival. However, Common Starlings and Tree Martins are more successfully occupying the boxes reducing the effectiveness of this plan by out competing the Swift Parrots.]

## c.
[The two "seasons" they compare are data from 2016 and 2019. In 2016, the boxes were newly deployed and by 2019 they had been well established. By 2019, the data showed that the non target birds were the main beneficiaries of the established boxes, potentially out competing the Swift Parrots.]

## d. 

 
| Model number | Seasons  | Distance to Forest Edge |  Model  |
|:------------:|:--------:|:-----------------------:|:-------:| 
| 0            |  No      |        No               | Null: No predictors     
| 1            |  Yes     |        Yes              | Saturated: All predictors    
| 2            |  Yes     |        No               | The predictor variable is seasons          
| 3            |  No      |        Yes              | The predictor varibale is distance to edge      

## e.

```{r, results='hide', message=FALSE, warning=FALSE}
nest_boxes_clean <- nest_boxes |> 
  janitor::clean_names() #clean the names

# model 0: null model 
model0 <- glm(sp ~ 1, 
              data = nest_boxes_clean, 
              family = binomial)

# model 1: saturated model 
model1 <- glm(sp ~ season * edge_distance, 
              data = nest_boxes_clean, 
              family = binomial)
# model 2: season predictor
model2 <- glm(sp ~ season, 
              data = nest_boxes_clean, 
              family = binomial)

# model 3: edge distance predictor
model3 <- glm(sp ~ edge_distance, 
              data = nest_boxes_clean, 
              family = binomial)
```


## f.

```{r}
# model 0 diagnostics
res0 <- simulateResiduals(model0)
plot(res0)
```
```{r}
# model 1 diagnostics
res1 <- simulateResiduals(model1)
plot(res1)
```

```{r}
# model 2 diagnostics
res2 <- simulateResiduals(model2)
plot(res2)
```

```{r}
# model 3 diagnostics
res3 <- simulateResiduals(model3)
plot(res3)
```


## g.

```{r}
AICc(model1, # Best fit: season and edge distance 
     model2,
     model3,
     model0) |> 
  # arranging output in descending order of AIC
  arrange(AICc)
```

[The best model as determined by Akaike’s Information Criterion (AIC) is Model 1.]




















































